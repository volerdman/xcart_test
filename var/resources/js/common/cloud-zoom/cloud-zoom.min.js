(function($){var scripts=document.getElementsByTagName("script"),last=scripts[scripts.length-1].src.lastIndexOf('/'),scriptPath=scripts[scripts.length-1].src.slice(0,last)
function format(str){for(var i=1;i<arguments.length;i++)str=str.replace('%'+(i-1),arguments[i]);return str}
function CloudZoom(jWin,opts){var sImg=$('img',jWin),img1,img2,zoomDiv=null,$mouseTrap=null,lens=null,$tint=null,softFocus=null,$ie6Fix=null,zoomImage,controlTimer=0,cw,ch,destU=0,destV=0,currV=0,currU=0,filesLoaded=0,mx,my,ctx=this,zw;setTimeout(function(){if($mouseTrap===null){var w=jWin.width();jWin.parent().append(format('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>',w/3,(w/2)-(w/6)));$('cloud-zoom-loading',jWin.parent()).css('opacity',0.5)}},200);var ie6FixRemove=function(){if($ie6Fix!==null){$ie6Fix.remove();$ie6Fix=null}};this.removeBits=function(){if(lens){lens.remove();lens=null};if($tint){$tint.remove();$tint=null};if(softFocus){softFocus.remove();softFocus=null};ie6FixRemove();$('.cloud-zoom-loading',jWin.parent()).remove()};this.destroy=function(){jWin.data('zoom',null);if($mouseTrap){$mouseTrap.unbind();$mouseTrap.remove();$mouseTrap=null};if(zoomDiv){zoomDiv.remove();zoomDiv=null};this.removeBits()};this.fadedOut=function(){if(zoomDiv){zoomDiv.remove();zoomDiv=null};this.removeBits()};this.controlLoop=function(){if(lens){var p=sImg.position(),leftCorner=p.left,rightCorner=sImg.outerWidth()-cw,topCorner=p.top,bottomCorner=sImg.outerHeight()-ch+p.top,marginLeft=intval(sImg.offset().left-sImg.parent().offset().left);if(opts.position!=='inside'){leftCorner+=marginLeft;rightCorner+=marginLeft+2*intval(lens.css('borderTopWidth'));bottomCorner+=2*intval(lens.css('borderTopWidth'))};var x=(mx-sImg.offset().left-(cw*0.5)+leftCorner+intval(lens.css('borderTopWidth')))>>0,y=(my-sImg.offset().top-(ch*0.5)+topCorner+intval(lens.css('borderTopWidth')))>>0;if(x<leftCorner){x=leftCorner}else if(x>rightCorner)x=rightCorner;if(y<topCorner){y=topCorner}else if(y>bottomCorner)y=bottomCorner;lens.css({left:x,top:y});if(opts.position!=='inside'){lens.css('background-position',(-x+leftCorner)+'px '+(-y+topCorner)+'px')}else lens.css('background-position',(-x)+'px '+(-y)+'px');destU=(((x-leftCorner)/sImg.outerWidth())*zoomImage.width)>>0;destV=(((y-topCorner)/sImg.outerHeight())*zoomImage.height)>>0;if(opts.position!=='inside'){var rightOuterCorner=zoomImage.width-zoomDiv.width(),bottomOuterCorner=zoomImage.height-zoomDiv.height();if(destU>rightOuterCorner)destU=rightOuterCorner;if(destV>bottomOuterCorner)destV=bottomOuterCorner};currU+=(destU-currU)/opts.smoothMove;currV+=(destV-currV)/opts.smoothMove;zoomDiv.css('background-position',(-(currU>>0)+'px ')+(-(currV>>0)+'px'))};controlTimer=setTimeout(function(){ctx.controlLoop()},30)};this.init2=function(img,id){filesLoaded++;if(id===1)zoomImage=img;if(filesLoaded===2)this.init()};this.init=function(){$('.cloud-zoom-loading',jWin.parent()).remove();var $m=$("<div class='mousetrap' style='background-image:url(\""+scriptPath+"/blank.png\")\'></div>");$mouseTrap=jWin.parent().append($m).find(':last');$mouseTrap=$('.mousetrap',jWin.parent());$mouseTrap.css({width:sImg.outerWidth(),height:sImg.outerHeight(),top:0,left:intval(sImg.offset().left-sImg.parent().offset().left),position:'absolute',zIndex:9999});$mouseTrap.bind('mousemove',this,function(event){mx=event.pageX;my=event.pageY});$mouseTrap.bind('mouseleave',this,function(event){clearTimeout(controlTimer);if(lens)lens.fadeOut(299);if($tint)$tint.fadeOut(299);if(softFocus)softFocus.fadeOut(299);zoomDiv.fadeOut(300,function(){ctx.fadedOut()});return false});$mouseTrap.bind('mouseenter',this,function(event){mx=event.pageX;my=event.pageY;zw=event.data;if(zoomDiv){zoomDiv.stop(true,false);zoomDiv.remove()};var xPos=opts.adjustX,yPos=opts.adjustY,siw=sImg.outerWidth(),sih=sImg.outerHeight(),w=opts.zoomWidth,h=opts.zoomHeight;if(opts.zoomWidth=='auto')w=siw;if(opts.zoomHeight=='auto')h=sih;var appendTo=jWin.parent();switch(opts.position){case'top':yPos-=h;break;case'right':xPos+=siw;break;case'bottom':yPos+=sih;break;case'left':xPos-=w;break;case'inside':w=siw;h=sih;break;default:appendTo=$('#'+opts.position);if(!appendTo.length){appendTo=jWin;xPos+=siw;yPos+=sih}else{w=appendTo.innerWidth();h=appendTo.innerHeight()}};zoomDiv=appendTo.append(format('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:99;"></div>',xPos,yPos,w,h,zoomImage.src)).find(':last');zoomDiv=$('.cloud-zoom-big',appendTo);if(sImg.attr('title')&&opts.showTitle){zoomDiv.append(format('<div class="cloud-zoom-title">%0</div>',sImg.attr('title')));$('.cloud-zoom-title',zoomDiv).css('opacity',opts.titleOpacity)};if($.browser.msie&&$.browser.version<7)$ie6Fix=$('<iframe frameborder="0" src="#"></iframe>').css({position:"absolute",left:xPos,top:yPos,zIndex:99,width:w,height:h}).insertBefore(zoomDiv);zoomDiv.fadeIn(500);if(lens){lens.remove();lens=null};cw=(sImg.outerWidth()/zoomImage.width)*zoomDiv.width();ch=(sImg.outerHeight()/zoomImage.height)*zoomDiv.height();lens=jWin.append(format("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>",cw,ch)).find(':last');lens=$('.cloud-zoom-lens',jWin);$mouseTrap.css('cursor',lens.css('cursor'));var noTrans=false;if(opts.tint){lens.css('background','url("'+sImg.attr('src')+'")');lens.css('background-size',sImg.outerWidth()+'px '+sImg.outerHeight()+'px');var p=sImg.position();$tint=jWin.append(format('<div class="cloud-zoom-tint" style="display:none;position:absolute; left:'+p.left+'px; top:'+p.top+'px; width:%0px; height:%1px; background-color:%2;" />',sImg.outerWidth(),sImg.outerHeight(),opts.tint)).find(':last');$tint=$('.cloud-zoom-tint',jWin);$tint.css({opacity:opts.tintOpacity,left:intval(sImg.offset().left-sImg.parent().offset().left)});noTrans=true;$tint.fadeIn(500)};if(opts.softFocus){lens.css('background','url("'+sImg.attr('src')+'")');lens.css('background-size',sImg.outerWidth()+'px '+sImg.outerHeight()+'px');jWin.append(format('<div class="cloud-zoom-soft" style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />',sImg.outerWidth()-2,sImg.outerHeight()-2,opts.tint));softFocus=$('.cloud-zoom-soft',jWin);softFocus.css('background','url("'+sImg.attr('src')+'")');softFocus.css('opacity',0.5);noTrans=true;softFocus.fadeIn(500)};if(!noTrans)lens.css('opacity',opts.lensOpacity);if(opts.position!=='inside')lens.fadeIn(500);zw.controlLoop();return})};img1=new Image();$(img1).load(function(){ctx.init2(this,0)});img1.src=sImg.attr('src');img2=new Image();$(img2).load(function(){ctx.init2(this,1)});img2.src=jWin.attr('href')};$.fn.CloudZoom=function(options){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){};this.each(function(){var relOpts,opts;eval('var	a = {'+$(this).attr('data-rel')+'}');relOpts=a;if($(this).is('.cloud-zoom')){$(this).css({position:'relative',display:'block'});$('img',$(this)).css({display:'block'});if($(this).parent().attr('id')!='wrap')$(this).wrap('<div id="wrap" style="top:0px;z-index:9990;position:relative;"></div>');opts=$.extend({},$.fn.CloudZoom.defaults,options);opts=$.extend({},opts,relOpts);$(this).data('zoom',new CloudZoom($(this),opts))}else if($(this).is('.cloud-zoom-gallery')){opts=$.extend({},relOpts,options);$(this).data('relOpts',opts);$(this).bind('click',$(this),function(event){var data=event.data.data('relOpts');$('#'+data.useZoom).data('zoom').destroy();$('#'+data.useZoom).attr('href',event.data.attr('href'));$('#'+data.useZoom+' img').attr('src',event.data.data('relOpts').smallImage);$('#'+event.data.data('relOpts').useZoom).CloudZoom();return false})}});return this};$.fn.CloudZoom.defaults={zoomWidth:'auto',zoomHeight:'auto',position:'right',tint:false,tintOpacity:0.5,lensOpacity:0.5,softFocus:false,smoothMove:3,showTitle:true,titleOpacity:0.5,adjustX:0,adjustY:0}})(jQuery)